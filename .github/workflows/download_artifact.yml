name: Display SHA Digest

on:
  workflow_run:
    workflows: ["Node.js CI with Docker"]
    types:
      - completed

jobs:
  download_context_artifact:
    runs-on: ubuntu-latest
    steps:
      - name: Download artifact
        uses: actions/download-artifact@v3
        with:
          name: sha_digest.json
          path: /home/runner/work/CI-CD/CI-CD
          
      - name: Return Parsed JSON
        id: return-parsed-json
        run: |
          let fs = require('fs');
          let data = fs.readFileSync('${{ github.workspace }}/sha_digest.json');
          return JSON.parse(data);
    
    outputs:
      property_one: ${{ steps.return-parsed-json.outputs.prop_1 }}

  log_context_values:
    needs:
      - download_context_artifact
    runs-on: ubuntu-latest
    steps:
      - name: Log Context Values
        run: |
          echo "${{ needs.download_context_artifact.outputs.property_one }}"
